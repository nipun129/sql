1.
SELECT * FROM CITY WHERE COUNTRYCODE = 'USA' AND POPULATION > 100000

2.
SELECT NAME FROM CITY WHERE COUNTRYCODE = 'USA' AND POPULATION > 120000;

3.
SELECT * FROM CITY;

4.
SELECT * FROM CITY WHERE ID = 1661;

5.
SELECT * FROM CITY WHERE COUNTRYCODE = JPN;

6.
SELECT NAME FROM CITY WHERE COUNTRYCODE = JPN;

7.
SELECT CITY,STATE FROM STATION;

8.
SELECT DISTINCT CITY FROM STATION WHERE ID % 2 = 0;

9.
SELECT COUNT(CITY) - COUNT(DISTINCT CITY) FROM STATION;

10.
SELECT  CITY, LENGTH(CITY) AS LEN_MIN FROM STATION ORDER BY LEN_MIN LIMIT 1;
SELECT  CITY, LENGTH(CITY) AS LEN_MAX FROM STATION ORDER BY LEN_MAX DESC LIMIT 1; 

11.
SELECT DISTINCT CITY FROM STATION WHERE CITY REGEXP '^[aeiouAEIOU]';

12.
SELECT DISTINCT CITY FROM STATION WHERE CITY REGEXP '[aeiouAEIOU]$';

13.
SELECT DISTINCT CITY FROM STATION WHERE CITY NOT REGEXP '^[aeiouAEIOU]';

14.
SELECT DISTINCT CITY FROM STATION WHERE CITY NOT REGEXP '[aeiouAEIOU]$';

15.
SELECT DISTINCT CITY FROM STATION WHERE CITY NOT REGEXP '^[aeiouAEIOU]' OR CITY NOT REGEXP '[aeiouAEIOU]$';

16.
SELECT DISTINCT CITY FROM STATION WHERE CITY NOT REGEXP '^[aeiouAEIOU]' AND CITY NOT REGEXP '[aeiouAEIOU]$';

17.
SELECT product_id, product_name
FROM Product
WHERE product_id NOT IN(SELECT product_id FROM Sales 
WHERE sale_date NOT BETWEEN '2019-01-01' and '2019-03-31');

18.
SELECT DISTINCT viewer_id
from Views WHERE viewer_id = author_id ORDER BY auhor_id;

19.
SELECT round(D2.im_orders*100/D1.del,2) 
FROM 
(SELECT count(delivery_id) as del FROM Delivery) D1,
(SELECT count(delivery_id) as im_orders FROM Delivery WHERE order_date = customer_pref_delivery_date) D2;

20.
select ad_id,
    ifnull(round(sum(action ='Clicked')/sum(action !='ignored') *100,2),0) ctr
from Ads
group by ad_id
order by ctr desc, ad_id;

21.
SELECT employee_id,
       COUNT(team_id) OVER(PARTITION BY team_id) AS team_size
FROM Employee ORDER BY employee_id;

22.
SELECT DISTINCT country_name,
CASE
WHEN (SUM(T.weather_state) OVER(PARTITION BY T.country_name)/COUNT(T.country_name) OVER(PARTITION BY T.country_name)) <= 15 THEN 'Cold'
WHEN (SUM(T.weather_state) OVER(PARTITION BY T.country_name)/COUNT(T.country_name) OVER(PARTITION BY T.country_name)) >= 25 THEN 'Hot'
ELSE 'Warm'
END AS weather_type 
FROM (SELECT C.country_name, W.*
FROM Weather W
INNER JOIN Countries C ON W.country_id = C.country_id WHERE day BETWEEN '2019-11-01' AND '2019-11-30') T;

23.
SELECT DISTINCT TEM.product_id,
round(SUM(TEM.price * TEM.units) OVER(PARTITION BY TEM.product_id)/
SUM(TEM.units) OVER(PARTITION BY TEM.product_id),2) AS average_price 
FROM (SELECT P.*, U.purchase_date, U.units
FROM Prices P
INNER JOIN UnitsSold U ON P.product_id = U.product_id WHERE U.purchase_date between P.start_date AND P.end_date) TEM;

24.
SELECT player_id, MIN(event_date) AS first_login FROM Activity GROUP BY player_id;

25.
SELECT player_id,(SELECT device_id FROM Activity WHERE event_date = TEM.first_login) AS device 
FROM(SELECT player_id, MIN(event_date) AS first_login FROM Activity GROUP BY player_id) TEM;

26.
SELECT * FROM (SELECT DISTINCT T.product_name,
SUM(T.unit) OVER(PARTITION BY T.product_id) AS unit
FROM (SELECT O.*, P.product_name,P.product_category
FROM Orders O
INNER JOIN Products P ON O.product_id = P.product_id WHERE O.order_date between '2020-02-01' AND '2020-02-29') T) B
WHERE B.unit >= 100;

27.
SELECT * FROM Users WHERE REGEXP_LIKE(mail, '^[a-zA-Z][a-zA-Z0-9\_\.\-]*@leetcode.com');

28.
SELECT customer_id,name FROM Customers
WHERE customer_id in (
SELECT O.customer_id
FROM Orders O
INNER JOIN Product P ON O.product_id = P.product_id WHERE order_date BETWEEN '2020-06-01' AND '2020-06-30'
GROUP BY O.customer_id
HAVING SUM(O.quantity*P.price) >= 100)
AND customer_id in (
SELECT O.customer_id
FROM Orders O
INNER JOIN Product P ON O.product_id = P.product_id WHERE order_date BETWEEN '2020-07-01' AND '2020-07-31'
GROUP BY O.customer_id
HAVING SUM(O.quantity*P.price) >= 100);

29.
SELECT DISTINCT title 
FROM Content C
INNER JOIN TVProgram T ON C.content_id = T.content_id WHERE T.program_date BETWEEN '2020-06-01' AND '2020-06-30'
AND C.content_type = 'Movies' AND C.Kids_content = 'Y';

30.
SELECT Q.id,Q.year,coalesce(N.npv,0)
FROM Queries Q
LEFT JOIN NPV N ON Q.id = N.id AND Q.year = N.year;

31.
SELECT Q.id,Q.year,coalesce(N.npv,0)
FROM Queries Q
LEFT JOIN NPV N ON Q.id = N.id AND Q.year = N.year;

32.
SELECT U.unique_id,E.name
FROM Employees E
LEFT JOIN EmployeeUNI U ON E.id = U.id;

33.
SELECT U.name,M.travelled_distance 
FROM (SELECT user_id,SUM(distance) AS travelled_distance FROM Rides GROUP BY user_id) M
RIGHT JOIN Users U ON U.id = M.user_id 
ORDER BY M.travelled_distance desc,U.name;

34.
SELECT * FROM (SELECT DISTINCT T.product_name,
SUM(T.unit) OVER(PARTITION BY T.product_id) AS unit
FROM (SELECT O.*, P.product_name,P.product_category
FROM Orders O
INNER JOIN Products P ON O.product_id = P.product_id WHERE O.order_date between '2020-02-01' AND '2020-02-29') T) B
WHERE B.unit >= 100;

35.
SELECT name FROM (SELECT user_id,COUNT(user_id) AS tot_rat FROM MovieRating GROUP BY user_id) U
INNER JOIN Users Us ON U.user_id = Us.user_id ORDER BY U.tot_rat desc,Us.name limit 1
UNION
SELECT title FROM (SELECT movie_id,SUM(rating)/COUNT(rating) AS avg_rat FROM MovieRating WHERE left(created_at,7)='2020-02' 
GROUP BY movie_id) R
INNER JOIN Movies M ON M.movie_id = R.movie_id ORDER BY R.avg_rat desc,M.title limit 1;

36.
SELECT U.name,M.travelled_distance 
FROM (SELECT user_id,SUM(distance) AS travelled_distance FROM Rides GROUP BY user_id) M
RIGHT JOIN Users U ON U.id = M.user_id 
ORDER BY M.travelled_distance desc,U.name;

37.
SELECT U.unique_id,E.name
FROM Employees E
LEFT JOIN EmployeeUNI U ON E.id = U.id;

38.
SELECT S.id,S.name FROM Students S
LEFT JOIN Departments D ON S.department_id = D.id
WHERE D.name IS NULL;

39.
WITH CallTable AS (
    SELECT CASE WHEN from_id < to_id THEN from_id ELSE to_id END AS person1,
    CASE WHEN from_id > to_id THEN from_id ELSE to_id END AS person2,
    duration
    FROM Calls
)
SELECT person1,person2,count(person1) AS call_count,sum(duration) AS total_duration
FROM CallTable GROUP BY person1,person2;

40.
